# 分布式限流器

## 总体框架
<img width="407" alt="image" src="https://github.com/user-attachments/assets/a01a159e-070f-4e88-9d8e-04a2c27b5bf3">


### 方案一：分布式锁
1）API网关向redis或者zk获取分布式锁（key可以是cgi） 
2）获取失败则自旋获取或者让客户端重试（可自旋一段时间后重试几次后失败），获取成功则执行限流算法(可以是计数、令牌桶或者漏桶)  

缺点：  
1)锁降低性能  

### 方案二：lua+redis
1）使用lua脚本来执行限流算法(例如令牌桶)  
2）客户端请求redis，执行脚本来获取是否被限流  

缺点：  
1）redis性能上限（个人理解集群也无法解决，单个cgi的限流key无法分布在多个redis实例）

### 方案三：负载均衡方案
1）利用负载均衡，将请求均匀分布到各个机器  
2）单机上实现限流算法   

缺点：  
1）限流精度较低  
2）机器动态扩缩容，影响整个集群的限流能力  
