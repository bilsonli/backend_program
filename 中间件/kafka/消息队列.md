# 基础知识
## 概念
使用队列来通信 的组件。它的本质，就是个转发器，包含发消息、存消息、消费消息的过程。最简单的消息队列模型如下：  
![image](https://github.com/user-attachments/assets/be4db8cc-e770-4b55-87b0-2134991c898e)

通常说的消息队列，简称MQ（Message Queue） ，它其实就指消息中间件，当前业界比较流行的开源消息中间件包括：RabbitMQ、RocketMQ、Kafka。  

## 应用场景
应用解耦  
流量削峰  
异步处理  
消息通讯  
日志处理 

## 消息可靠性(本质是上ack机制)
三个阶段：  
1）生产者可靠性:同步、异步、事务(确认机制)
2）存储端可靠性:持久化（同步、异步刷盘）
3）消费端可靠性：执行完业务逻辑才响应ack

## 消息有序性
1）全局有序：一个topic，只有一个partition  
2）局部有序：消息发送按照partition key划分，同一个key的发送到同一个partition

## 重复消费问题
1）幂等性
2）过滤

## 消息积压问题
1）是否是bug
2）扩容：增加partition和consumer机器
3）临时queue处理，先缓存到queue中，处理完后再切回去

## 技术选型

| |Kafka| RocketMQ| RabbitMQ|
|----|-----|-----|-------|
|单机吞吐量|17.3w/s|11.6w/s|2.6w/s（消息做持久化）|
|开发语言|Scala/Java|Java|Erlang|
|主要维护者|Apache|Alibaba|Mozilla/Spring|
|订阅形式|基于topic，按照topic进行正则匹配的发布订阅模式|基于topic/messageTag，按照消息类型、属性进行正则匹配的发布订阅模式|提供了4种：direct, topic ,Headers和fanout。fanout就是广播模式
|持久化|支持大量堆积|支持大量堆积|支持少量堆积|
|顺序消息|支持|支持|不支持|
|集群方式|天然的Leader-Slave，无状态集群，每台服务器既是Master也是Slave|常用 多对’Master-Slave’ 模式，开源版本需手动切换Slave变成Master|支持简单集群，'复制’模式，对高级集群模式支持不好。|
|性能稳定性|较差|一般|好|

## 参考链接
https://juejin.cn/post/7088909199475736612
